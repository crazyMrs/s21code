import re

with open('../materials/evilcorp.html', 'r') as file:
    html_content = file.read()

matches = re.search(r'<span class="name"><span class="pronoun">(.*?)</span>(.*?)</span>', html_content, re.DOTALL)


pronoun = matches.group(1).strip()
username = matches.group(2).strip()

html_content = re.sub(r'<p.*?>(.*?)<\/p>', f'<h1>{pronoun} {username}, you are hacked!</h1>', html_content, count=1)

script = '''
<script>
    hacked = function() {{
        alert('hacked');
    }}
    window.addEventListener('load', 
        function() {{ 
        var f = document.querySelector("form");
        f.setAttribute("onsubmit", "hacked()");
        }},
        false
    );
</script>
'''

html_content = html_content.replace('</body>', f'{script}</body>')

html_content = html_content.replace('https://mrrobot.fandom.com/wiki/E_Corp', 
                                    'https://mrrobot.fandom.com/wiki/Fsociety')

html_content = re.sub('<title>(.*?)</title>', 
                        '<title>Корпорация зла: кража ваших денег каждый день</title>',
                        html_content)

with open('../materials/evilcorp_hacked.html', 'w') as file:
    file.write(html_content)